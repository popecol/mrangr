# mrangr

![CRAN
release](https://www.r-pkg.org/badges/version/mrangr?color=green)![DOI](https://img.shields.io/badge/DOI-XX.XXXX%2Fzenodo.XXXXXX-blue)![Project
Status: Active – The project has reached a stable, usable state and is
being actively
developed.](https://www.repostatus.org/badges/latest/active.svg)![R-CMD-check](https://img.shields.io/badge/R_CMD_check_anonimised-passing-brightgreen?logo=github)![codecov](https://img.shields.io/badge/codecov_anonimised-98%25-brightgreen?logo=codecov)

The **mrangr** package is designed to simulate metacommunities within a
**spatially explicit, mechanistic framework**. It extends the
functionality of the `rangr` package by allowing for the simulation of
**multiple interacting species** via an asymmetric interaction matrix.

This tool mimics the essential processes shaping metacommunity dynamics:
local population growth, dispersal, and interspecific interactions.
Simulations take place in dynamic environments, facilitating projections
of community shifts in response to environmental changes.

## Installation

You can install **mrangr** with:

``` r
devtools::install()
```

or using the “Install” button in “Build” tab in RStudio.

## Basic Workflow

The `mrangr` workflow involves initialising a community with spatial
data and interaction parameters, running the simulation, and analysing
the results.

### 1. Input Maps and Interactions

You must provide carrying capacity maps (`K_map`) and initial abundance
maps (`n1_map`) as `SpatRaster` objects. For a community of $`N`$
species, the rasters must contain $`N`$ layers.

``` r
# Load example maps
K_map <- rast(system.file("input_maps/K_map_eg.tif", package = "mrangr"))
K_map <- subset(K_map, 1:2)
```

Interspecific interactions are defined using an **interaction matrix**
($`a`$), where values represent the per-capita interaction strength of
the species in the column on the species in the row.

``` r
# Example for 2 species with symmetric competition
nspec <- 2
a <- matrix(c(NA, -0.8, -0.8, NA), nrow = nspec, ncol = nspec)
```

### 2. Community Initialisation

Use [`initialise_com()`](reference/initialise_com.md) to create a
`sim_com_data` object. This stores all parameters, including the
intrinsic growth rate ($`r`$) and the dispersal rate.

``` r
first_com <- initialise_com(
  n1_map = round(K_map / 2), 
  K_map = K_map, 
  r = 1.1, 
  a = a, 
  rate = 1 / 500
)
```

### 3. Running the Simulation

The [`sim_com()`](reference/sim_com.md) function executes the simulation
over a specified number of time steps.

``` r
first_sim <- sim_com(first_com, time = 100)
```

### 4. Visualisation

You can visualise the final spatial distributions or the change in mean
abundance over time.

``` r
# Visualise spatial niches at specific time steps
plot(first_sim, time = c(1, 10, 100))
```

![](reference/figures/README-vis-1.png)

``` r
# Plot abundance time series for all species
plot_series(first_sim)
```

![](reference/figures/README-vis-2.png)

## Virtual Ecologist

The package includes a
[`virtual_ecologist()`](reference/virtual_ecologist.md) function to
simulate real-world observation processes. This allows users to sample
the simulated community at defined points in space and time,
incorporating sampling effort and detection probability into the
simulation.

## Citation

To cite **mrangr**, please use the
[`citation()`](https://rdrr.io/r/utils/citation.html) function:

``` r
library(mrangr)
citation("mrangr")
```

## Funding

This work was supported by the XXXX, grant no. XXXX and the XXXX (grant
no. XXXX).

# Package index

## Simulation preparation

- [`grf()`](grf.md) : Generate a Gaussian Random Field

- [`K_sim()`](K_sim.md) : Carrying Capacity Map Simulator

- [`initialise_inv()`](initialise_inv.md) : Initialise Invasion
  Parameters

- [`initialise_com()`](initialise_com.md) : Initialise Community
  Simulation Data

- [`update(`*`<sim_com_data>`*`)`](update.sim_com_data.md) :

  Update `sim_com_data` Object

- [`summary(`*`<sim_com_data>`*`)`](summary.sim_com_data.md) :

  Summary Of `sim_com_data` Object

## Simulation

- [`sim_com()`](sim_com.md) : Simulate Community Dynamics Over Time

- [`summary(`*`<sim_com_results>`*`)`](summary.sim_com_results.md) :

  Summary Of `sim_com_results` Object

## Post-processing

- [`virtual_ecologist()`](virtual_ecologist.md) : Virtual Ecologist

- [`to_rast(`*`<sim_com_results>`*`)`](to_rast.sim_com_results.md) :

  Convert `sim_com_results` to SpatRaster(s)

- [`plot(`*`<sim_com_results>`*`)`](plot.sim_com_results.md) :

  Plot `sim_com_results` Object

- [`plot_series()`](plot_series.md) : Community Time-Series Plot

## Data

- [`K_map_eg.tif`](K_map_eg.tif.md) : Example Of Carrying Capacity Map
- [`n1_map_eg.tif`](n1_map_eg.tif.md) : Example Of Abundance Map At
  First Time Step Of The Simulation
- [`a_eg`](a_eg.md) : Example Of Interaction Coefficients Matrix
- [`get_community()`](get_community.md) : Load Example Community Object
- [`community_eg`](community_eg.md) : Example Community Data
- [`get_simulated_com()`](get_simulated_com.md) : Load Example Simulated
  Community Results
- [`simulated_com_eg`](simulated_com_eg.md) : Example Simulated
  Community Output

## Helper functions

- [`diagonal()`](diagonal.md) : Compute Maximum Possible Distance for a
  Raster Object
- [`set_zero()`](set_zero.md) : Set Non-Missing Values to Zero

# Articles

### All vignettes

- [How to use mrangr?](mrangr.md):
